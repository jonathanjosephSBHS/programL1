<html>
<head>
    <title>Run Mania</title>
 </head>
<body>
    <canvas id="gameCanvas" width="800", height="800"></canvas>
    <script>
    
    var canvas,canvasContext;
    
    window.onload = function(){
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');
                
        document.addEventListener('keydown', keyPressed);
        document.addEventListener('keyup', keyReleased);
        
        for(var i = 0; i < totalCars; i++){
            makeCars();
        }
        
        setInterval(mainloop, 1000/60)
    }
    
    var lanes = new Image();
    lanes.src = 'images/lanes.png';
        
    var car = new Image();
    car.src = 'images/car.png';
        
    var car2 = new Image();
    car2.src = 'images/car2.png';
        
    var player = new Image();
    player.src = 'images/player.png'
    
    const PLAYER_SIZE = 15;
    var playerXpos = 200;
    var playerYpos = 400 - PLAYER_SIZE;
    var playerXspeed = 5;
    var playerYspeed = 5;
    
    var enemyXpos = 40;
    var enemyYpos = 40;
    const ENEMY_SIZE = 40;
    var enemyXspeed = 8;
    var enemyYspeed = 8;
    
    var leftKeyPress = false;
    var rightKeyPress = false;
    var upKeyPress = false;
    var downKeyPress = false;
        
    const LEFT_KEY = 65
    const RIGHT_KEY = 68
    const UP_KEY = 87
    const DOWN_KEY = 83
    
    var score = 0;
    
    var cars = [];
    var totalCars = 8; 
    var carCounter = 0;
        
    function mainloop(){
        colorRect(300,100,100,100,'yellow')//score
        colorRect(0,0,canvas.width,canvas.height,'black')//bg
        drawImg(lanes,0,0,1000,800)//lanes
        drawImg(player,playerXpos,playerYpos,30,50)//player
        drawImg(car,enemyXpos,enemyYpos,100,50,)//enemy
        drawText('30px Arial','Score: '+score,650,40,'White');//score
        
        
        enemyMove();
        playerMove();
        
        drawCars();
        moveCars();

    }
    
    function keyPressed(evt){
        if(evt.keyCode == LEFT_KEY){
            leftKeyPress = true;
        }
        if(evt.keyCode == RIGHT_KEY){
            rightKeyPress = true;
        }
        if(evt.keyCode == UP_KEY){
            upKeyPress = true;
        }
        if(evt.keyCode == DOWN_KEY){
            downKeyPress = true;
        }
        
    }
    
    function keyReleased(evt){
         if(evt.keyCode == LEFT_KEY){
            leftKeyPress = false;
        }
        if(evt.keyCode == RIGHT_KEY){
            rightKeyPress = false;
        }
        if(evt.keyCode == UP_KEY){
            upKeyPress = false;
        }
        if(evt.keyCode == DOWN_KEY){
            downKeyPress = false;
        }
        
    }
    
    function makeCars(){
        var randLane = Math.floor(Math.random()*4);
        const CAR_WIDTH = 100;
        const CAR_HEIGHT = 50;
        
        if(carCounter%2 == 0){
            var carXpos = canvas.width;
            var carYpos = (CAR_HEIGHT * 3) + CAR_HEIGHT * randLane;
            var carXspeed = Math.floor(Math.random()*-10);
            var carImg = new Image();
            carImg.src = 'images/car2.png';
        } else {
            var carXpos = 0;
            var carYpos = (CAR_HEIGHT * 1.5) + CAR_HEIGHT * randLane;
            var carXspeed = Math.floor(Math.random()*(10 - 4)) + 4;
            var carImg = new Image();
            carImg.src = 'images/car.png';
        }
        carCounter++;
        
        var car = {
            carXpos: carXpos,
            carYpos: carYpos,
            CAR_WIDTH: CAR_WIDTH,
            CAR_HEIGHT: CAR_HEIGHT,
            carXspeed: carXspeed,
            carImg: carImg
        }
        cars.push(car);
    }    
        
    function drawCars(){
        cars.forEach(function(car,i,array){
             drawImg(car.carImg,car.carXpos,car.carYpos,car.CAR_WIDTH,car.CAR_HEIGHT);
        });
    }    
       
    function moveCars(){
        cars.forEach(function(car,i,array){
           car.carXpos += car.carXspeed;
            if(car.carXpos > canvas.width){
            car.carXpos = 0 - car.CAR;
        }
            if(car.carYpos + car.CAR_HEIGHT > playerYpos && car.carYpos < playerYpos + PLAYER_SIZE && car.carXpos + car.CAR_WIDTH > playerXpos && car.carXpos < playerXpos + PLAYER_SIZE){
            playerXpos = 400;
            playerYpos = canvas.height - PLAYER_SIZE;
            score = 0;
            car.carXspeed = 8;
            playerXspeed = 5;
            playerYspeed = 5;
        }
              
        });
    }      
        
    function enemyMove(){
        enemyXpos += enemyXspeed
        
        if(enemyXpos > canvas.width){
            enemyXpos = 0 - ENEMY_SIZE;
        }
        
        if(enemyYpos + ENEMY_SIZE > playerYpos && enemyYpos < playerYpos + PLAYER_SIZE && enemyXpos + ENEMY_SIZE > playerXpos && enemyXpos < playerXpos + PLAYER_SIZE){
            playerXpos = 400;
            playerYpos = canvas.height - PLAYER_SIZE;
            score = 0;
            enemyXspeed = 8;
            playerXspeed = 5;
            playerYspeed = 5;
        }
        
    }
    
    function playerMove(){
        if(leftKeyPress && playerXpos > 0){
            playerXpos -= playerXspeed
        }
        if(rightKeyPress && playerXpos < canvas.width - PLAYER_SIZE){
            playerXpos += playerXspeed
        }
        if(upKeyPress && playerYpos > 0){
            playerYpos -= playerYspeed
        }
        if(downKeyPress && playerYpos <  canvas.height - PLAYER_SIZE){
            playerYpos += playerYspeed
        }
        if (playerYpos < 5){
            score ++;
            playerXpos = 400;
            playerYpos = canvas.height - PLAYER_SIZE;
            enemyXspeed += 0.25;
            playerXspeed += 0.1;
            playerYspeed += 0.1;
            }
    }
    
    
    function colorRect(x,y,w,h,c){
        canvasContext.fillStyle = c;
        canvasContext.fillRect (x,y,w,h,c);
    }
        
    function drawImg(src,x,y,w,h){
        canvasContext.drawImage(src,x,y,w,h);
    }
        
    function drawText(f,msg,x,y,c){
        canvasContext.font = f;
        canvasContext.fillStyle = c;
        canvasContext.fillText(msg, x, y);
    }
    

    
</script>
</body> 
</html>