<html>
<head>
    <title>Run Mania</title>
 </head>
<body>
    <canvas id="gameCanvas" width="800", height="800"></canvas>
    <script>
    
    var canvas,canvasContext;
    
    window.onload = function(){
        canvas = document.getElementById('gameCanvas');
        canvasContext = canvas.getContext('2d');
                
        document.addEventListener('keydown', keyPressed);
        document.addEventListener('keyup', keyReleased);
        
        for(var i = 0; i < totalCars; i++){
            makeCars();                         // Making the car array
        }
        
        setInterval(mainloop, 1000/60)
    }
    
    var lanes4 = new Image();
    lanes4.src = 'images/lanes4.png';             // The Road background
        
    var car = new Image();
    car.src = 'images/carback.png';             // The Car facing right
        
    var car2 = new Image();
    car2.src = 'images/car.png';                // The Car facing left
        
    var player = new Image();
    player.src = 'images/player.png'            // The Player
    
    const PLAYER_WIDTH = 25;
    const PLAYER_HEIGHT = 45;
    var playerXpos = 350;
    var playerYpos = 800 - PLAYER_HEIGHT;
    var playerXspeed = 5;
    var playerYspeed = 5;
    
    var enemyXpos = 40;
    var enemyYpos = 40;
    const ENEMY_SIZE = 40;
    var enemyXspeed = 8;
    var enemyYspeed = 8;
    
    var leftKeyPress = false;
    var rightKeyPress = false;
    var upKeyPress = false;
    var downKeyPress = false;
        
    const LEFT_KEY = 65
    const RIGHT_KEY = 68
    const UP_KEY = 87
    const DOWN_KEY = 83
    
    var score = 0;
    
    var cars = [];                                                                      // Car Array making starts
    var totalCars = 8; 
    var carCounter = 0;
        
    var gameRun = true;
        
    function mainloop(){
        if(gameRun){
        colorRect(300,100,100,100,'yellow');                                             // score
        colorRect(0,0,canvas.width,canvas.height,'black');                               // bg
        drawImg(lanes4,0,0,1000,800);                                                    // 4 lanes
        drawImg(player,playerXpos,playerYpos,PLAYER_WIDTH,PLAYER_HEIGHT);                // player
        drawText('30px Arial','Score: '+score,650,40,'White');                           // score
        
        playerMove();
        drawCars();
        moveCars();
        } else {
            colorRect(0,0,canvas.width,canvas.height,'black');
        drawText('30px Arial','Game over ' +  ' total Score: '+score,canvas.width/3,canvas.height/2,'White');                           // score
        }
    }
    
    function keyPressed(evt){                                                            // Player Movement keybinding (key down)
        if(evt.keyCode == LEFT_KEY){
            leftKeyPress = true;
        }
        if(evt.keyCode == RIGHT_KEY){
            rightKeyPress = true;
        }
        if(evt.keyCode == UP_KEY){
            upKeyPress = true;
        }
        if(evt.keyCode == DOWN_KEY){
            downKeyPress = true;                                                         
        }
        
    }
    
    function keyReleased(evt){                                                           // Player Movement keybinding (key up)
         if(evt.keyCode == LEFT_KEY){
            leftKeyPress = false;
        }
        if(evt.keyCode == RIGHT_KEY){
            rightKeyPress = false;
        }
        if(evt.keyCode == UP_KEY){
            upKeyPress = false;
        }
        if(evt.keyCode == DOWN_KEY){
            downKeyPress = false;                                                          
        }
        
    }
     
        
    function makeCars(){
        const CAR_WIDTH = 100;
        const CAR_HEIGHT = 50; 
        var carD = '';
        
        
        if(carCounter%2 == 0 && carCounter != 0){                                           // Initial Car array make
            var carXpos = canvas.width;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * carCounter;
            var carXspeed = -2;
            var carImg = new Image();
            carD = 'left';
            carImg.src = 'images/car.png';
        } else {
            var carXpos = -100;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * carCounter + 10;
            var carXspeed = 2;
            var carImg = new Image();
            carD = 'right';
            carImg.src = 'images/carback.png';                                              
        }
        if(carCounter == 0){
            var carXpos = canvas.width;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 0.8;
            var carXspeed = -2;
            var carImg = new Image();
            carD = 'left';
            carImg.src = 'images/car.png';                                                   // Car Array Optimization begins
        }
        if(carCounter == 2){
            var carXpos = canvas.width;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 2.5;
            var carXspeed = -2;
            var carImg = new Image();
            carD = 'left';
            carImg.src = 'images/car.png';
        }
        if(carCounter == 3){
            var carXpos = -100;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 3;
            var carXspeed = 2;
            var carImg = new Image();
            carD = 'right';
            carImg.src = 'images/carback.png';
        }
        if(carCounter == 5){
            var carXpos = -100;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 4.5;
            var carXspeed = 2;
            var carImg = new Image();
            carD = 'right';
            carImg.src = 'images/carback.png';
        }
        if(carCounter == 6){
            var carXpos = canvas.width;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 5.5;
            var carXspeed = -2;
            var carImg = new Image();
            carD = 'left';
            carImg.src = 'images/car.png';
        }
        if(carCounter == 7){
            var carXpos = -100;
            var carYpos = CAR_HEIGHT * carCounter + CAR_HEIGHT * 6.25;
            var carXspeed = 2;
            var carImg = new Image();
            carD = 'right';
            carImg.src = 'images/carback.png';
        }                                                                                      // Car Array Optiminzation ends
            
        carCounter++;
        
        var car = {
            carXpos: carXpos,
            carYpos: carYpos,
            CAR_WIDTH: CAR_WIDTH,
            CAR_HEIGHT: CAR_HEIGHT,
            carXspeed: carXspeed,
            carImg: carImg,
            carD: carD
        }
        cars.push(car);
    }    
        
    function drawCars(){
        cars.forEach(function(car,i,array){
             drawImg(car.carImg,car.carXpos,car.carYpos,car.CAR_WIDTH,car.CAR_HEIGHT);
        });
    }    
       
    function moveCars(){
        cars.forEach(function(car,i,array){
           car.carXpos += car.carXspeed;
            if(car.carD == 'left'){
                car.carXspeed = -2 - score / 4;
            } else if(car.carD == 'right'){
                car.carXspeed = 2 + score / 4;
            }
            if(car.carXpos > canvas.width){
            car.carXpos = -100 ;                                                    // Left car going right then coming back from left
            }
            if(car.carXpos < -100 ){
            car.carXpos = canvas.width - car.CAR_WIDTH + 100;                       // Right car goind left then coming back from right
            }  
            if(playerXpos + PLAYER_WIDTH > car.carXpos && playerXpos < car.carXpos + car.CAR_WIDTH && playerYpos + PLAYER_HEIGHT > car.carYpos && playerYpos < car.carYpos + car.CAR_HEIGHT && car.carD == 'right'){
            playerXpos = canvas.width / 2 - PLAYER_WIDTH / 2;
            playerYpos = canvas.height - PLAYER_HEIGHT;
            car.carXspeed = 2;
            playerXspeed = 5;
            playerYspeed = 5;                                                       // Collision and Speed Reset
            gameRun = false;
            }
            if(playerXpos + PLAYER_WIDTH > car.carXpos && playerXpos < car.carXpos + car.CAR_WIDTH && playerYpos + PLAYER_HEIGHT > car.carYpos && playerYpos < car.carYpos + car.CAR_HEIGHT && car.carD == 'left'){
            playerXpos = canvas.width / 2 - PLAYER_WIDTH / 2;
            playerYpos = canvas.height - PLAYER_HEIGHT;
            car.carXspeed = -2;
            playerXspeed = 5;
            playerYspeed = 5;                                                       // Collision and Speed Reset of opposite Cars
            gameRun = false;
            }
              
        });
    }      
        
    function playerMove(){                                                         // Player movement and keybind connection starts
        if(leftKeyPress && playerXpos > 0){
            playerXpos -= playerXspeed
        }
        if(rightKeyPress && playerXpos < canvas.width - PLAYER_WIDTH){
            playerXpos += playerXspeed
        }
        if(upKeyPress && playerYpos > 0){
            playerYpos -= playerYspeed
        }
        if(downKeyPress && playerYpos <  canvas.height - PLAYER_HEIGHT){
            playerYpos += playerYspeed
        }
        if (playerYpos < 5){
            score ++;
            playerXpos = 400;
            playerYpos = canvas.height - PLAYER_HEIGHT;
            enemyXspeed += 0.25;
            playerXspeed += 0.1;
            playerYspeed += 0.1;
            }                                                                       // Player movement and keybind connection ends      
    }
    
    function colorRect(x,y,w,h,c){
        canvasContext.fillStyle = c;
        canvasContext.fillRect (x,y,w,h,c);
    }
        
    function drawImg(src,x,y,w,h){
        canvasContext.drawImage(src,x,y,w,h);                                      // Function to dispaly images on the screen     
    }
        
    function drawText(f,msg,x,y,c){                                                // Function to display Text on the screen
        canvasContext.font = f;
        canvasContext.fillStyle = c;
        canvasContext.fillText(msg,x,y);
    }
    
//    function colorText(msg,x,y,f,c){                                                // Function to display losing screen text
//        canvasContext.fillStyle = c;
//        canvasContext.font = f;
//        canvasContext.filltext(msg,x,y);
//    }
    
</script>
</body> 
</html>